serial version written with C
